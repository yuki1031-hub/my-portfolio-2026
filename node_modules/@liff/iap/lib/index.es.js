import{__awaiter as t,__generator as r,__extends as e,__spreadArray as o,__read as n}from"tslib";import{LiffModule as i}from"@liff/use";import{validators as c}from"@liff/is-api-available";import{call as u}from"@liff/native-bridge";import{createLiffError as a}from"@liff/util";import{UNKNOWN as d}from"@liff/consts";import{getContext as s}from"@liff/store";import{fetch as f,getEndPoint as p}from"@liff/server-api";function l(e){return t(this,arguments,void 0,(function(t){var e=t.productIds;return r(this,(function(t){switch(t.label){case 0:return[4,u("iap.getPlatformProducts",{productIds:e}).catch((function(t){if(t.code&&t.description)throw a(t.code,t.description);throw a(d,"Failed to get platform products",{cause:t})}))];case 1:return[2,t.sent().products]}}))}))}var h=function(e){return t(void 0,[e],void 0,(function(t){var e=t.productId,o=t.orderId;return r(this,(function(t){switch(t.label){case 0:if(!window.confirm("Proceed with a test in-app purchase?"))throw a("CANCELED","Transaction was canceled.");return[4,f(p("iapVirtualConfirm"),{method:"POST",body:JSON.stringify({productId:e,orderId:o})})];case 1:return t.sent(),[2]}}))}))},m=function(e){return t(void 0,[e],void 0,(function(t){var e,o=t.productId,n=t.orderId;return r(this,(function(t){switch(t.label){case 0:return(null==(e=s())?void 0:e.isIapSandbox)?[4,h({productId:o,orderId:n})]:[3,2];case 1:case 3:return t.sent(),[2];case 2:return[4,u("iap.createPayment",{productId:o,orderId:n}).catch((function(t){if(t.code&&t.description)throw a(t.code,t.description);throw a(d,"Failed to get platform products",{cause:t})}))]}}))}))},v=function(i){function s(){return null!==i&&i.apply(this,arguments)||this}return e(s,i),Object.defineProperty(s.prototype,"name",{get:function(){return"iap"},enumerable:!1,configurable:!0}),s.prototype.install=function(){var e=this;return{getPlatformProducts:function(){for(var i=[],u=0;u<arguments.length;u++)i[u]=arguments[u];return t(e,void 0,void 0,(function(){return r(this,(function(t){return c.iap(),[2,l.apply(void 0,o([],n(i),!1))]}))}))},createPayment:function(){for(var i=[],u=0;u<arguments.length;u++)i[u]=arguments[u];return t(e,void 0,void 0,(function(){return r(this,(function(t){return c.iap(),[2,m.apply(void 0,o([],n(i),!1))]}))}))},requestConsentAgreement:function(){return t(e,void 0,void 0,(function(){return r(this,(function(e){return c.iap(),[2,t(void 0,void 0,void 0,(function(){return r(this,(function(t){switch(t.label){case 0:return[4,u("iap.requestConsentAgreement").catch((function(t){if(t.code&&t.description)throw a(t.code,t.description);throw a(d,"Failed to request consent agreement",{cause:t})}))];case 1:return t.sent(),[2]}}))}))]}))}))}}},s}(i);export{v as IapModule};
